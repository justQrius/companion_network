<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>5</storyId>
    <title>Initialize Git Repository with Best Practices</title>
    <status>drafted</status>
    <generatedAt>2025-12-02</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-initialize-git-repository-with-best-practices.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Developer</asA>
    <iWant>proper version control from the start</iWant>
    <soThat>I can track changes, collaborate effectively, and follow Python AI project conventions</soThat>
    <tasks>
      - Task 1: Verify Git Installation and Initialize Repository (AC: 1)
        - Subtask 1.1: Verify `git --version` works
        - Subtask 1.2: Run `git init` in project root
        - Subtask 1.3: Verify `.git` directory created
      
      - Task 2: Verify Gitignore Configuration (AC: 2, 9)
        - Subtask 2.1: Verify `.gitignore` contains all required exclusions from architecture doc
        - Subtask 2.2: Confirm `.env`, `*.db`, `.venv`, `__pycache__`, `*.pyc` are present
        - Subtask 2.3: Test exclusions with `git check-ignore` for critical files
      
      - Task 3: Configure Git Attributes (AC: 3)
        - Subtask 3.1: Create `.gitattributes` file if needed for future LFS support
        - Subtask 3.2: Add basic text file normalization rules
      
      - Task 4: Stage Files for Initial Commit (AC: 4, 6, 7)
        - Subtask 4.1: Add `README.md` to staging
        - Subtask 4.2: Add `pyproject.toml` to staging
        - Subtask 4.3: Add `uv.lock` to staging (CRITICAL for reproducibility)
        - Subtask 4.4: Add `.env.example` to staging
        - Subtask 4.5: Add `.gitignore` to staging
        - Subtask 4.6: Add project structure files (`__init__.py`, directory structure)
        - Subtask 4.7: Verify `.env` is NOT staged using `git status`
      
      - Task 5: Create Initial Commit (AC: 5, 8)
        - Subtask 5.1: Run `git commit -m "Initial project setup with ADK, MCP, and Gradio"`
        - Subtask 5.2: Verify commit created with `git log`
        - Subtask 5.3: Verify `git status` shows clean working directory
      
      - Task 6: Verification and Security Audit (AC: 6)
        - Subtask 6.1: Run `git log --all --decorate -- .env` to confirm no .env in history
        - Subtask 6.2: Create verification script `tests/verify_git.py` to check git configuration
        - Subtask 6.3: Run verification script to confirm all ACs
    </tasks>
  </story>

  <acceptanceCriteria>
    1. **Git Initialized**: Git repository initialized (`git init`).
    2. **Gitignore Configured**: `.gitignore` properly configured for Python AI projects.
    3. **Gitattributes Configured**: `.gitattributes` configured (if using Git LFS for future model files).
    4. **Initial Commit**: Initial commit includes: `README.md`, `pyproject.toml`, `uv.lock`, `.env.example`, `.gitignore`, project structure.
    5. **Commit Message**: Initial commit message: `"Initial project setup with ADK, MCP, and Gradio"`.
    6. **Secrets Not Committed**: `.env` file is NOT committed (verified via `git log --all --decorate -- .env` returns empty).
    7. **Lock File Committed**: `uv.lock` IS committed (ensures reproducibility).
    8. **Clean Status**: Running `git status` shows clean working directory after initial commit.
    9. **Gitignore Exclusions**: `.gitignore` excludes: `.env`, `*.db`, `.venv`, `__pycache__`, `*.pyc`.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document - Version Control Strategy</title>
        <section>Version Control Strategy (lines 79-211)</section>
        <snippet>Defines Git workflow, branch strategy (main/dev), commit conventions, dependency locking with uv.lock, and comprehensive .gitignore template for Python AI projects. Critical: Always commit uv.lock for reproducibility, never commit .env for security.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>Git Configuration (lines 94-113)</section>
        <snippet>Acceptance criteria for Git initialization: repo initialized, .gitignore excludes .env/__pycache__/.venv, .env.example tracked, README allows fresh developer setup.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epics - Story 1.5 Details</title>
        <section>Story 1.5 (lines 249-278)</section>
        <snippet>Full story definition with acceptance criteria, prerequisites (Stories 1.2-1.4), technical notes on .gitignore template, uv.lock commitment, atomic commit strategy, and branch strategy from architecture doc.</snippet>
      </doc>
      <doc>
        <path>docs/prd.md</path>
        <title>Product Requirements Document</title>
        <section>Project Classification and Technical Stack</section>
        <snippet>Project uses Python 3.10+, uv for dependency management, Google ADK, MCP, and Gradio. Emphasizes reproducible builds and modern tooling.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>.gitignore</path>
        <kind>configuration</kind>
        <symbol>N/A</symbol>
        <lines>1-64</lines>
        <reason>Existing .gitignore file that needs verification against architecture spec. Currently excludes Python artifacts, virtual environments, IDEs, logs, test coverage, and .env (line 62).</reason>
      </artifact>
      <artifact>
        <path>pyproject.toml</path>
        <kind>configuration</kind>
        <symbol>N/A</symbol>
        <lines>1-12</lines>
        <reason>Project metadata file defining dependencies (google-adk, mcp, gradio, python-dotenv) and Python version requirement (>=3.10). Must be included in initial commit.</reason>
      </artifact>
      <artifact>
        <path>uv.lock</path>
        <kind>lock file</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>CRITICAL: Dependency lock file ensuring reproducible builds. Must be committed to Git per architecture ADR-005.</reason>
      </artifact>
      <artifact>
        <path>.env.example</path>
        <kind>configuration template</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Template for environment variables without actual secrets. Must be tracked in Git to document required configuration.</reason>
      </artifact>
      <artifact>
        <path>README.md</path>
        <kind>documentation</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Project documentation created in Story 1.6. Must be included in initial commit.</reason>
      </artifact>
      <artifact>
        <path>alice_companion/__init__.py</path>
        <kind>package marker</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Python package initialization file for Alice's companion. Part of project structure to commit.</reason>
      </artifact>
      <artifact>
        <path>bob_companion/__init__.py</path>
        <kind>package marker</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Python package initialization file for Bob's companion. Part of project structure to commit.</reason>
      </artifact>
      <artifact>
        <path>shared/__init__.py</path>
        <kind>package marker</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Python package initialization file for shared utilities. Part of project structure to commit.</reason>
      </artifact>
      <artifact>
        <path>tests/verify_structure.py</path>
        <kind>test</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Verification script from Story 1.2. Should be included in initial commit as part of test suite.</reason>
      </artifact>
      <artifact>
        <path>tests/verify_dependencies.py</path>
        <kind>test</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Verification script from Story 1.3. Should be included in initial commit as part of test suite.</reason>
      </artifact>
      <artifact>
        <path>tests/verify_secrets.py</path>
        <kind>test</kind>
        <symbol>N/A</symbol>
        <lines>N/A</lines>
        <reason>Verification script from Story 1.4. Should be included in initial commit as part of test suite.</reason>
      </artifact>
    </code>
    <dependencies>
      <python>
        <package name="google-adk" version=">=1.19.0" />
        <package name="mcp" version=">=1.22.0" extras="[cli]" />
        <package name="gradio" version="latest stable" />
        <package name="python-dotenv" version="latest" />
      </python>
      <system>
        <tool name="git" version="any" purpose="Version control system" />
        <tool name="uv" version="1.0+" purpose="Python package manager and dependency resolver" />
      </system>
    </dependencies>
  </artifacts>

  <constraints>
    - **CRITICAL SECURITY**: `.env` file must NEVER be committed to version control. Verify with `git log --all --decorate -- .env` before pushing.
    - **Reproducibility**: `uv.lock` MUST be committed to ensure exact dependency versions across all environments (Architecture ADR-005).
    - **Gitignore Completeness**: Must exclude `.env`, `*.db`, `.venv`, `__pycache__`, `*.pyc` at minimum per architecture spec (lines 127-195).
    - **Atomic Commit**: Initial commit should include all fundamental setup in one commit with clear message.
    - **Branch Strategy**: Use `main` for stable code, `dev` for active development (Architecture lines 112-114).
    - **Commit Conventions**: Use clear, present-tense messages with component prefix (Architecture lines 117-120).
    - **File Tracking**: All verification scripts from previous stories must be included in initial commit.
  </constraints>

  <interfaces>
    <command>
      <name>git init</name>
      <kind>CLI command</kind>
      <signature>git init</signature>
      <path>N/A (system command)</path>
      <purpose>Initialize Git repository in project root</purpose>
    </command>
    <command>
      <name>git add</name>
      <kind>CLI command</kind>
      <signature>git add &lt;file&gt;</signature>
      <path>N/A (system command)</path>
      <purpose>Stage files for commit</purpose>
    </command>
    <command>
      <name>git commit</name>
      <kind>CLI command</kind>
      <signature>git commit -m "message"</signature>
      <path>N/A (system command)</path>
      <purpose>Create commit with staged changes</purpose>
    </command>
    <command>
      <name>git status</name>
      <kind>CLI command</kind>
      <signature>git status</signature>
      <path>N/A (system command)</path>
      <purpose>Check working directory status and staged files</purpose>
    </command>
    <command>
      <name>git log</name>
      <kind>CLI command</kind>
      <signature>git log [options]</signature>
      <path>N/A (system command)</path>
      <purpose>View commit history</purpose>
    </command>
    <command>
      <name>git check-ignore</name>
      <kind>CLI command</kind>
      <signature>git check-ignore &lt;file&gt;</signature>
      <path>N/A (system command)</path>
      <purpose>Test if file is ignored by .gitignore rules</purpose>
    </command>
  </interfaces>

  <tests>
    <standards>
      Testing for this story follows the verification script pattern established in previous stories. Create `tests/verify_git.py` to programmatically verify all acceptance criteria: Git repository exists (.git directory), .env not in history, uv.lock is committed, .gitignore contains required exclusions. Script should print clear pass/fail status for each check.
    </standards>
    <locations>
      - tests/verify_git.py (new verification script for this story)
      - tests/verify_structure.py (existing, should be committed)
      - tests/verify_dependencies.py (existing, should be committed)
      - tests/verify_secrets.py (existing, should be committed)
    </locations>
    <ideas>
      <test ac="1">
        <description>Verify Git repository initialized</description>
        <approach>Check for existence of .git directory in project root</approach>
      </test>
      <test ac="2,9">
        <description>Verify .gitignore configuration</description>
        <approach>Read .gitignore file and assert it contains: .env, *.db, .venv, __pycache__, *.pyc</approach>
      </test>
      <test ac="3">
        <description>Verify .gitattributes exists</description>
        <approach>Check for .gitattributes file (optional for MVP, note if missing)</approach>
      </test>
      <test ac="4">
        <description>Verify initial commit contents</description>
        <approach>Run `git ls-tree -r HEAD --name-only` and verify README.md, pyproject.toml, uv.lock, .env.example, .gitignore are present</approach>
      </test>
      <test ac="5">
        <description>Verify commit message</description>
        <approach>Run `git log -1 --pretty=%B` and check for "Initial project setup with ADK, MCP, and Gradio"</approach>
      </test>
      <test ac="6">
        <description>Verify .env not in Git history</description>
        <approach>Run `git log --all --decorate -- .env` and assert output is empty</approach>
      </test>
      <test ac="7">
        <description>Verify uv.lock is committed</description>
        <approach>Run `git ls-files uv.lock` and assert it returns the file path</approach>
      </test>
      <test ac="8">
        <description>Verify clean working directory</description>
        <approach>Run `git status --porcelain` and assert output is empty after initial commit</approach>
      </test>
    </ideas>
  </tests>
</story-context>
